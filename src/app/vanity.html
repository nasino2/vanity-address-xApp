<div [class]="themeClass" fxFlex fxLayout="column">
  <mat-toolbar fxLayout="row" color="primary" style="background-color: rgb(48, 82, 255);"class="mat-elevation-z4">  
    <mat-toolbar-row>
      <div fxLayout="row" fxLayoutGap="0.5em" fxLayoutAlign="start center">
        <img src="../assets/topbar_logo.png" width="50px" height="50px" alt="Vanity Address xApp Logo">
        <label style="font-weight: bold;">{{title}}</label>  
      </div>
    </mat-toolbar-row>
  </mat-toolbar>
  
  <mat-card class="mat-card-red" *ngIf="errorLabel" fxLayout="column" fxLayoutGap="0.5em;">
    <label>Sorry that this error happened! Please copy the following error and contact @nixerFFM or @WietseWind on twitter or send a mail to: XummCommunity@gmail.com . Thanks for your help!</label><br>
    <label class="break-words" (click)="copyError()">{{errorLabel}}</label>
    <button mat-button class="xumm-grey-background" aria-label="Copy Error" (click)="copyError()">
      Copy&nbsp;<mat-icon style="font-size: 16px; width: fit-content; height: fit-content;">content_copy</mat-icon>
    </button>
  </mat-card>

  <!--label *ngIf="infoLabel" style="color: red">{{infoLabel}}</label><br><br>
  <label *ngIf="infoLabel2" style="color: red">{{infoLabel2}}</label>
  <label *ngIf="infoLabel3" style="color: red">{{infoLabel3}}</label-->

  <div>
    <div *ngIf="testMode">
      <mat-card class="mat-card-red">
        You can not choose a XRPL vanity address while connected to the XRP Ledger TEST net.
        Please connect your XUMM app to the XRP Ledger MAIN net and open the xApp again.
        
        <div style="padding-top: 1em;" fxLayoutGap="0.5em" fxLayoutAlign="center center">
          <button mat-raised-button class="xumm-grey-background" (click)="close()" [disabled]="loadingData">Close</button>
      </div>
      </mat-card>
    </div>
    <div *ngIf="!testMode">
      <mat-vertical-stepper linear #escrowStepper class="theme-background">
        <mat-step completed="false" editable="false" fxLayout="column" fxLayoutGap="0.5em">
          <mat-card fxLayout="column" fxLayoutGap="0.5em">
              <ng-template matStepLabel>Description</ng-template>
              <label>A vanity address is a wallet address containing a few characters you like at the beginning or the end of the wallet address.</label>
              <label>This xApp allows you to search for a vanity address. It will check your desired characters against our database and will show you suitable addresses we found.</label>
              <label>You can select the address you like, pay to make it your own and we will transfer the address over to you, so you are the only one having access to it!</label>
              <mat-card class="mat-card-orange" style="padding-top: 1em;">
                To "transfer" the address to you, we use the XRP Ledger feature called "Regular Key". This means once of your existing accounts can sign transactions in the name of you new vanity address.
                The private key of the vanity address will be therefore disabled so we do not have access anymore. The only person having access is YOU!
              </mat-card>
              <label>To be able to claim your Vanity Address, you have to activate it with 20 XRP and make a payment equal to 20-50 USD, depending on the complexity of your address.</label>
              <label>So please make sure to have enough XRP in your wallet.</label>
              <div style="padding-top: 0.5em;" fxLayoutGap="0.5em">
                <button mat-raised-button color="primary" (click)="moveNext()">Next</button>
            </div>
          </mat-card>
        </mat-step>
    
        <mat-step completed="false" editable="false">
          <mat-card fxLayout="column" fxLayoutGap="0.5em">
              <ng-template matStepLabel>Regular Key Account</ng-template>
              <div fxLayout="column" fxLayoutGap="0.5em" *ngIf="originalAccountInfo">
                <label class="description">Please choose the account which will be able to sign transactions for your new vanity address.</label>
                <label>This account also needs to be used to activate the vanity address with 20 XRP and pay for your vanity address (10-50 USD - depending on your choosen vanity address)</label>
                <label *ngIf="originalAccountInfo && (originalAccountInfo.Account || originalAccountInfo.account)">Currently selected:</label>
                <label *ngIf="originalAccountInfo && originalAccountInfo.Account">{{originalAccountInfo.Account}}</label>
                <label *ngIf="originalAccountInfo && originalAccountInfo.account">{{originalAccountInfo.account}}</label>
    
                <div fxLayoutAlign="start center" style="padding-top: 0.5em;">
                  <button mat-raised-button color="primary" (click)="signIn()" [disabled]="loadingData">{{originalAccountInfo && (originalAccountInfo.Account || originalAccountInfo.account) ? 'Change Account' : 'Sign In' }}</button>
                </div>
              </div>
    
              <div style="padding-top: 0.5em;">
                <mat-card *ngIf="originalAccountInfo && originalAccountInfo.error && originalAccountInfo.error == 'actNotFound' && !loadingData" class="mat-card-red">
                  <label>Account not activated on {{testMode ? 'Testnet' : 'Mainnet'}}.</label>
                </mat-card>
              </div>
    
              <div *ngIf="!originalAccountInfo || loadingData" fxLayoutAlign="start center">
                <label>Loading...</label>
                <mat-progress-spinner color="primary" mode="indeterminate" diameter=25></mat-progress-spinner>
              </div>
    
              <div style="padding-top: 0.5em;" fxLayoutGap="0.5em">
                  <button mat-raised-button color="primary" (click)="moveNext()" [disabled]="!originalAccountInfo || !originalAccountInfo.Account || loadingData">Next</button>
                  <button mat-raised-button class="xumm-grey-background" (click)="moveBack()" [disabled]="!originalAccountInfo || loadingData">Back</button>
              </div>
          </mat-card>
        </mat-step>
    
        <mat-step completed="false" editable="false">
          <mat-card fxLayout="column" fxLayoutGap="1em">
              <ng-template matStepLabel>Vanity words</ng-template>
              <label class="description">Please enter the characters you want your address to start or end with.</label>
              <mat-card class="mat-card-orange">
                <label>Hint: An XRP Ledger account always starts with an 'r'. So if you look for 'Teddy', the account account name will start with 'rTeddy" but can end with only 'Teddy'!</label>
              </mat-card>
              <form fxLayout="column" fxLayoutGap="0.5em" style="padding-top: 1em;">
                <mat-form-field>
                  <input #inpvanityword matInput name="vanity word" placeholder="Vanity characters your address should start/end with" [(ngModel)]="vanityWordInput">
                  <mat-hint *ngIf="vanityWordInput && vanityWordInput.trim().length < 3 && !loadingData">At least 3 characters are required</mat-hint>           
                </mat-form-field>
              </form>
    
              <div>
                <button mat-raised-button color="primary" (click)="searchVanityAddress()" [disabled]="loadingData || !vanityWordInput || vanityWordInput.trim().length < 3">Search</button>
              </div>
    
              <div *ngIf="searchResult && !selectedVanityAddress" fxLayoutGap="0.5em">
                <label>Please select one of the vanity addressses below:</label>
                <mat-table [dataSource]="searchResult" class="mat-elevation-z8">

                  <ng-container matColumnDef="account">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Vanity address </mat-header-cell>
                    <mat-cell *matCellDef="let address">
                        <span>
                          <label>{{address}}</label>
                        </span>
                    </mat-cell>
                  </ng-container>
              
                  <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                  <mat-row  *matRowDef="let row; columns: displayedColumns;" (click)="selectVanityAddress(row)"></mat-row>
              
                </mat-table>
    
              </div>

              <div *ngIf="selectedVanityAddress">
                <label>Your selected vanity address is:</label>
                <div fxLayout="row" fxLayoutGap="0.5em" fxLayoutAlign="start center">
                  <label>{{selectedVanityAddress}}</label>
                  <button mat-icon-button color="warn" (click)="selectedVanityAddress = null">
                    <mat-icon>highlight_off</mat-icon>
                  </button>
                </div>
                
              </div>

              <div *ngIf="loadingData" fxLayoutAlign="center center">
                <label>Loading...</label>
                <mat-progress-spinner color="primary" mode="indeterminate" diameter=25></mat-progress-spinner>
              </div>
    
              <div style="padding-top: 0.5em;" fxLayoutGap="0.5em">
                  <button mat-raised-button color="primary" (click)="moveNext()" [disabled]="!selectedVanityAddress || loadingData">Next</button>
                  <button mat-raised-button class="xumm-grey-background" (click)="moveBack()" [disabled]="loadingData">Back</button>
              </div>
          </mat-card>
        </mat-step>
    
        <mat-step completed="false" editable="false">
          <mat-card fxLayout="column" fxLayoutGap="0.5em">
            <ng-template matStepLabel>Purchase of Vanity Address</ng-template>
            <label class="description">To purchase your new address please click the button below.</label>
            <mat-card class="mat-card-blue">
              <label>You aggree to pay the XRP equivalent of ~ {{getPurchaseAmount()}} USD to buy your vanity address {{selectedVanityAddress}}</label>
            </mat-card>
            <mat-card class="mat-card-orange">
              <label>Funds can not be restorded. After successfully purchase and account activation, the account is YOURS and yours only! The account can not be returned to us!</label>
            </mat-card>

            <div *ngIf="!purchaseSuccess">
              <button mat-raised-button color="primary" (click)="buyVanityAddress()" [disabled]="loadingData">Buy Vanity Address</button>
            </div>

            <div>
              <mat-card *ngIf="!loadingData && !purchaseSuccess" class="mat-card-red">Your payment was not successfull on the XRP Ledger MAIN net.</mat-card>
              <mat-card *ngIf="!loadingData && purchaseSuccess" class="mat-card-green" fxLayout="row" fxLayoutGap="0.3em" fxLayoutAlign="start center">
                <i class="material-icons xumm-green" style="font-size: 3em;">
                    check_circle_outline
                </i>
                <label>Congratulations. The address {{selectedVanityAddress}} is YOURS!!!</label>
              </mat-card>
            </div>
            

            <div style="padding-top: 0.5em;" fxLayoutGap="0.5em">
              <button mat-raised-button color="primary" (click)="moveNext()" [disabled]="!purchaseSuccess || loadingData">Next</button>
              <button mat-raised-button class="xumm-grey-background" (click)="moveBack()" [disabled]="loadingData">Back</button>
            </div>
          </mat-card>
        </mat-step>
    
        <mat-step completed="false" editable="false">
          <mat-card fxLayout="column" fxLayoutGap="0.5em">
              <ng-template matStepLabel>Address activation</ng-template>
              <mat-card class="mat-card-orange">
                <label>For an XRPL account to be active and to be able to be used, it has to hold at least 20 XRP. Only when 20 XRP were sent there, the account is seen as "active".</label>
              </mat-card>
              <label>So next we will activate your account by sending 20 XRP + 0.001 XRP for some fees. The total will be 20.001 XRP.</label>
              <label>Additionally, we will make your account {{originalAccountInfo.Account}} able to sign transactions for {{selectedVanityAddress}}</label>

              <div *ngIf="!accountActivated && !loadingData">
                <button mat-raised-button color="primary" (click)="activateVanityAddress()" [disabled]="loadingData">Activate Vanity Address</button>
              </div>

              <mat-card *ngIf="purchaseSuccess && !loadingData" class="mat-card-green" fxLayout="row" fxLayoutGap="0.3em" fxLayoutAlign="start center">
                <i class="material-icons xumm-green" style="font-size: 3em;">
                    check_circle_outline
                </i>
                <label>Congratulations. The address {{selectedVanityAddress}} is YOURS!!!</label>
              </mat-card>

          </mat-card>
        </mat-step>
    
      </mat-vertical-stepper>
    </div>
  </div>
</div>